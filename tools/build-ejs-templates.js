const ejs = require('ejs');
const fs = require('fs-extra');
const path = require('path');
const TEMPLATES_PATH = path.resolve(__dirname, '../content/templates');
const OUTPUT_PATH = path.resolve(__dirname, '../');

const DATA = require('../content/index');

const templates = fs
  .readdirSync(TEMPLATES_PATH)
  .filter(file => file.endsWith('.ejs'));
templates.forEach(async template => {
  const templatePath = path.resolve(TEMPLATES_PATH, template);
  const outputPath = path.resolve(OUTPUT_PATH, template.replace(/\.ejs$/, ''));
  const output = await ejs.renderFile(templatePath, {
    ...DATA,
    DONT_EDIT_WARNING: `! DO NOT EDIT THIS FILE. IT IS AUTOGENERATED.\nTo edit this file, make an edit to its template in \`${path
      .relative(path.dirname(outputPath), templatePath)
      .replace(/\\/g, '/')}\`.`
  });
  fs.writeFileSync(outputPath, output);
});
